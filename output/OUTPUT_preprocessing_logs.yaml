====================================================================================================
ğŸš€ NYC TAXI DATA CLEANING PIPELINE WITH FOCUSED VISUALIZATIONS
====================================================================================================
ğŸ“‚ Searching for files matching: C:/Users/Anya/master_thesis/tmp/chunk_*.parquet
Found 49 parquet files. Loading...
Raw combined data shape: (46.2m, 20)
Column names: ['VendorID', 'tpep_pickup_datetime', 'tpep_dropoff_datetime', 'passenger_count', 'trip_distance', 'pickup_longitude', 'pickup_latitude', 'RateCodeID', 'store_and_fwd_flag', 'dropoff_longitude', 'dropoff_latitude', 'payment_type', 'fare_amount', 'extra', 'mta_tax', 'tip_amount', 'tolls_amount', 'improvement_surcharge', 'total_amount', 'RatecodeID']
ğŸ—‘ï¸  Dropping columns: ['VendorID', 'RateCodeID', 'store_and_fwd_flag', 'extra', 'mta_tax', 'tolls_amount', 'improvement_surcharge', 'passenger_count', 'payment_type', 'tip_amount', 'total_amount']
ğŸ“‰ Removed 0 rows with trip_distance <= 0
ğŸ“‰ Removed 1.3k rows with 0 or negative duration
ğŸ“‰ Removed 155.6k rows with identical pickup/dropoff coordinates
âœ… Data loaded and preprocessed. Shape: (46.0m, 9)

ğŸ“Š Calculating derived features...
   â„¹ï¸ Using 'trip_distance' column (from meter/GPS) for distance calculation
âœ… Derived features created

====================================================================================================

ğŸ“Š PRE-PROCESSED STATISTICS (After loading + feature engineering)
====================================================================================================
             Metric  Mean Median Std Dev    Min    Max
Trip Duration (min) 15.03  10.52  153.39 0.0167 192.3k
      Distance (km) 11.33   2.74   10.0k 0.0161  30.7m
   Avg Speed (km/h) 77.31  17.22  134.3k 0.0002 625.4m
           Fare ($) 12.34   9.00   48.17 0.0100 154.8k
       Price/km ($)  3.85   3.29   24.79 0.0000  76.8k
      Price/min ($)  1.11 0.9330   14.56 0.0000  40.4k
Dataset size: 46.0m rows
====================================================================================================

ğŸ“Š Creating raw data visualization...

ğŸ§¹ Stage 1: Basic validity checks...
After basic cleaning: 46.0m (100.0%)
   ğŸ“ˆ Saved: 01_stage1_trip_duration_min.png
      Before: 46.0m records, range: 0.02â€“192313.38
      After:  46.0m records, range: 0.02â€“192313.38

ğŸ§¹ Stage 2: Geographic outliers (NYC bounding box)...
After geographic filtering: 46.0m (removed 0)
   ğŸ“ˆ Saved: 02_stage2_trip_distance_km.png
      Before: 46.0m records, range: 0.02â€“30694342.00
      After:  46.0m records, range: 0.02â€“30694342.00

ğŸ§¹ Stage 3: Speed-based outliers (1-120 km/h)...
After speed filtering: 45.9m (removed 87.7k)
   ğŸ“ˆ Saved: 03_stage3_avg_speed_kmh.png
      Before: 46.0m records, range: 0.00â€“625372892.31
      After:  45.9m records, range: 1.00â€“119.91

ğŸ§¹ Stage 4: Trip duration outliers (IQR method)...
After duration filtering: 45.4m (removed 546.1k)
   ğŸ“ˆ Saved: 04_stage4_trip_duration_min.png
      Before: 45.9m records, range: 0.02â€“1474.08
      After:  45.4m records, range: 0.02â€“48.12

ğŸ§¹ Stage 5: Distance outliers (IQR method)...
After distance filtering: 42.9m (removed 2.5m)
   ğŸ“ˆ Saved: 05_stage5_trip_distance_km.png
      Before: 45.4m records, range: 0.02â€“82.88
      After:  42.9m records, range: 0.02â€“14.48

ğŸ§¹ Stage 6: Pricing outliers...
After pricing filtering: 42.8m (removed 103.7k)
   ğŸ“ˆ Saved: 06_stage6a_price_per_km.png
      Before: 42.9m records, range: 0.00â€“76822.98
      After:  42.8m records, range: 0.50â€“19.99
   ğŸ“ˆ Saved: 06_stage6b_price_per_min.png
      Before: 42.9m records, range: 0.00â€“14770.47
      After:  42.8m records, range: 0.50â€“37.59

====================================================================================================
ğŸ‰ CLEANING SUMMARY
====================================================================================================
Original size (after loading):  46.0m
Final size (after cleaning):    42.8m
Retained:                       93.1%
Removed as outliers:            6.9%
====================================================================================================

ğŸ“Š POST-PROCESSED STATISTICS (After all 6 cleaning stages)
====================================================================================================
             Metric   Mean Median Std Dev    Min    Max
Trip Duration (min)  11.51   9.92    7.14 0.0667  48.12
      Distance (km)   3.42   2.57    2.72 0.0322  14.48
   Avg Speed (km/h)  18.12  16.69    7.95   1.58 119.87
           Fare ($)  10.22   8.50    5.48 0.2400 200.00
       Price/km ($)   3.67   3.37    1.44 0.5026  19.99
      Price/min ($) 0.9931 0.9213  0.3369 0.5000  37.59
Dataset size: 42.8m rows
====================================================================================================

ğŸ’¾ Saving to C:/Users/Anya/master_thesis/output\taxi_data_cleaned_full.parquet...
ğŸ“Š Statistics saved to: C:/Users/Anya/master_thesis/output\cleaning_statistics.csv
ğŸ“Š Comparison saved to: C:/Users/Anya/master_thesis/output\statistics_comparison.csv
âœ… All files saved successfully.

ğŸ“ Output files in: C:/Users/Anya/master_thesis/output
   â€¢ taxi_data_cleaned_full.parquet (main dataset)
   â€¢ cleaning_report.pkl (cleaning metadata)
   â€¢ robust_scaler.pkl (preprocessing scaler)
   â€¢ cleaning_statistics.csv (post-processed stats)
   â€¢ statistics_comparison.csv (pre vs post)
   â€¢ FOCUSED 2-boxplot PNG files per stage

====================================================================================================
ğŸ‰ PIPELINE COMPLETE - Ready for clustering/analysis phase
====================================================================================================